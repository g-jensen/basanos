name: "User API"

before_each:
  run: echo "Resetting test users"
  timeout: 2s

scenarios:
  - id: list
    name: "List users returns JSON array"
    run:
      command: echo '[{"id":1,"name":"alice"},{"id":2,"name":"bob"}]'
      timeout: 5s
    assertions:
      - command: ${ASSERT}/assert_contains "alice" ${RUN_OUTPUT}/stdout
        timeout: 1s
      - command: ${ASSERT}/assert_contains "bob" ${RUN_OUTPUT}/stdout
        timeout: 1s

  - id: create
    name: "Create user returns 201"
    run:
      command: echo "201 Created"
      timeout: 5s
    assertions:
      - command: ${ASSERT}/assert_equals ${SPEC_ROOT}/api/users/expected_create.fixture ${RUN_OUTPUT}/stdout
        timeout: 1s
      - command: ${ASSERT}/assert_equals 0 ${RUN_OUTPUT}/exit_code
        timeout: 1s
